<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="Sync Planner - Integrasi Perencanaan Harian & Manajemen Tugas dengan Kanban Board">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sync Planner">
    
    <title>Sync Planner + Kanban Board</title>
    
    <!-- PWA Manifest (inline base64 to keep single file) -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlN5bmMgUGxhbm5lciArIEthbmJhbiIsCiAgInNob3J0X25hbWUiOiAiU3luYyBQbGFubmVyIiwKICAiZGVzY3JpcHRpb24iOiAiSW50ZWdyYXNpIFBlcmVuY2FuYWFuIEhhcmlhbiAmIE1hbmFqZW1lbiBUdWdhcyIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzY2N2VlYSIsCiAgInRoZW1lX2NvbG9yIjogIiM2NjdlZWEiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIyYVdWM1FtOTRQU0l3SURBZ01UQXdJREV3TUNJZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01EQXZjM1puSWo0OGNtVmpkQ0IzYVdSMGFEMGlNVEF3SWlCb1pXbG5hSFE5SWpFd01DSWdjbmc5SWpJd0lpQm1hV3hzUFNJalpqVTVaVEJpSWk4K1BIUmxlSFFnZUQwaU5UQWlJSGs5SWpZd0lpQm1iMjUwTFdaaGJXbHNlVDBpYzJGdWN5MXpaWEpwWmlJZ1ptbHNiRDBpZDJocGRHVWlJR1p2Ym5RdGMybDZaVDBpTkRBaUlIUmxlSFF0WVc1amFHOXlQU0p0YVdSa2JHVWlQdUtvbHp3dmRHVjRkRDQ4TDNOMlp6ND0iLAogICAgICAic2l6ZXMiOiAiOTZ4OTYiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-500: #6b7280;
            --gray-700: #374151;
            --gray-900: #111827;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px; /* Space for install banner */
        }

        /* PWA Install Banner */
        .pwa-install-banner {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.15);
            z-index: 9999;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .pwa-install-banner.show {
            display: flex;
        }

        .pwa-install-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pwa-install-icon {
            font-size: 2rem;
        }

        .pwa-install-text h4 {
            color: var(--gray-900);
            margin-bottom: 2px;
        }

        .pwa-install-text p {
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        .pwa-install-actions {
            display: flex;
            gap: 10px;
        }

        .pwa-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pwa-btn-install {
            background: var(--primary);
            color: white;
        }

        .pwa-btn-install:hover {
            background: var(--primary-dark);
        }

        .pwa-btn-dismiss {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .nav-tab {
            padding: 12px 30px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 30px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.3);
        }

        .nav-tab.active {
            background: white;
            color: var(--primary);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ==================== SYNC PLANNER STYLES ==================== */
        .planner-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .planner-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-100);
        }

        .card-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .card-title {
            font-size: 1.3rem;
            color: var(--gray-900);
        }

        .time-block {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            margin-bottom: 12px;
            background: var(--gray-50);
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .time-block:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .time-label {
            min-width: 70px;
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .time-content {
            flex: 1;
        }

        .time-title {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 4px;
        }

        .time-desc {
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: var(--gray-50);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checklist-item:hover {
            background: var(--gray-100);
        }

        .checklist-item.checked {
            background: #ecfdf5;
        }

        .checklist-item.checked .check-text {
            text-decoration: line-through;
            color: var(--gray-500);
        }

        .checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid var(--gray-300);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .checklist-item.checked .checkbox {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .check-text {
            flex: 1;
            color: var(--gray-700);
        }

        .progress-container {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid var(--gray-100);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 12px;
            background: var(--gray-200);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #34d399);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .reflection-textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .reflection-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .reflection-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--gray-700);
        }

        .reflection-group {
            margin-bottom: 20px;
        }

        /* ==================== PAIRWISE COMPARISON STYLES ==================== */
        .pairwise-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1100px) {
            .pairwise-container {
                grid-template-columns: 1fr;
            }
        }

        .pairwise-guide {
            grid-column: 1;
        }

        .guide-content {
            font-size: 0.95rem;
            color: var(--gray-700);
        }

        .guide-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-100);
        }

        .guide-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .guide-section h4 {
            color: var(--gray-900);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .guide-section p {
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .guide-steps {
            padding-left: 20px;
            line-height: 1.8;
        }

        .guide-steps li {
            margin-bottom: 8px;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 10px;
        }

        @media (max-width: 500px) {
            .tips-grid {
                grid-template-columns: 1fr;
            }
        }

        .tip-item {
            display: flex;
            gap: 10px;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 10px;
        }

        .tip-icon {
            font-size: 1.5rem;
        }

        .tip-item strong {
            display: block;
            color: var(--gray-900);
            margin-bottom: 2px;
        }

        .tip-item p {
            font-size: 0.85rem;
            color: var(--gray-500);
            margin: 0;
        }

        .islamic-reminder {
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid var(--success);
        }

        .islamic-reminder h4 {
            color: #047857;
        }

        .islamic-reminder em {
            display: block;
            font-style: italic;
            color: #065f46;
            margin-bottom: 8px;
        }

        /* Options Input */
        .options-input-area {
            margin-top: 10px;
        }

        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .option-input {
            flex: 1;
            padding: 14px 18px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .option-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn-add-option {
            padding: 14px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-add-option:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .options-list {
            min-height: 100px;
            margin-bottom: 15px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: var(--gray-50);
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .option-item:hover {
            background: var(--gray-100);
        }

        .option-number {
            width: 28px;
            height: 28px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .option-text {
            flex: 1;
            color: var(--gray-700);
        }

        .option-delete {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            color: var(--gray-400);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .option-delete:hover {
            background: var(--danger);
            color: white;
        }

        .options-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 2px solid var(--gray-100);
            flex-wrap: wrap;
            gap: 10px;
        }

        .options-count {
            color: var(--gray-500);
            font-size: 0.9rem;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-primary, .btn-secondary {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-200);
        }

        .btn-secondary:disabled {
            color: var(--gray-400);
            cursor: not-allowed;
        }

        /* Comparison Area */
        .comparison-card {
            grid-column: 1 / -1;
        }

        .comparison-progress {
            margin-bottom: 25px;
        }

        .progress-info {
            text-align: center;
            margin-bottom: 10px;
            color: var(--gray-600);
        }

        .comparison-question {
            text-align: center;
            margin-bottom: 30px;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 8px;
        }

        .question-hint {
            color: var(--gray-500);
            font-size: 0.9rem;
        }

        .comparison-options {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .compare-btn {
            flex: 1;
            max-width: 350px;
            min-width: 250px;
            padding: 25px;
            background: white;
            border: 3px solid var(--gray-200);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .compare-btn:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(37, 99, 235, 0.15);
        }

        .compare-btn.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
        }

        .compare-label {
            display: block;
            width: 40px;
            height: 40px;
            background: var(--gray-200);
            color: var(--gray-600);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .compare-btn:hover .compare-label,
        .compare-btn.selected .compare-label {
            background: var(--primary);
            color: white;
        }

        .compare-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-800);
            display: block;
        }

        .vs-divider {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-400);
            padding: 0 10px;
        }

        .comparison-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* Results */
        .results-card {
            grid-column: 1 / -1;
        }

        .results-summary {
            text-align: center;
            margin-bottom: 25px;
            color: var(--gray-600);
            font-size: 1.05rem;
        }

        .results-list {
            margin-bottom: 25px;
        }

        .result-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px 20px;
            background: var(--gray-50);
            border-radius: 12px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .result-item:hover {
            transform: translateX(5px);
        }

        .result-item.rank-1 {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid #f59e0b;
        }

        .result-item.rank-2 {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border-left: 4px solid #9ca3af;
        }

        .result-item.rank-3 {
            background: linear-gradient(135deg, #fed7aa, #fdba74);
            border-left: 4px solid #f97316;
        }

        .result-rank {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .rank-1 .result-rank {
            background: #f59e0b;
            color: white;
        }

        .rank-2 .result-rank {
            background: #9ca3af;
            color: white;
        }

        .rank-3 .result-rank {
            background: #f97316;
            color: white;
        }

        .result-item:not(.rank-1):not(.rank-2):not(.rank-3) .result-rank {
            background: var(--gray-300);
            color: var(--gray-600);
        }

        .result-info {
            flex: 1;
        }

        .result-title {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 4px;
        }

        .result-score {
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        .result-bar-container {
            width: 100px;
            height: 8px;
            background: var(--gray-200);
            border-radius: 10px;
            overflow: hidden;
        }

        .result-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #60a5fa);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .results-matrix-toggle {
            text-align: center;
            margin-bottom: 20px;
        }

        .results-matrix {
            margin-bottom: 25px;
            padding: 20px;
            background: var(--gray-50);
            border-radius: 12px;
        }

        .results-matrix h4 {
            margin-bottom: 15px;
            color: var(--gray-800);
        }

        .matrix-container {
            overflow-x: auto;
        }

        .matrix-container table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .matrix-container th,
        .matrix-container td {
            padding: 10px;
            text-align: center;
            border: 1px solid var(--gray-200);
        }

        .matrix-container th {
            background: var(--gray-200);
            font-weight: 600;
        }

        .matrix-container td.win {
            background: #d1fae5;
            color: #047857;
        }

        .matrix-container td.lose {
            background: #fee2e2;
            color: #b91c1c;
        }

        .matrix-container td.tie {
            background: #fef3c7;
            color: #92400e;
        }

        .matrix-container td.diagonal {
            background: var(--gray-100);
            color: var(--gray-400);
        }

        .matrix-note {
            font-size: 0.8rem;
            color: var(--gray-500);
            margin-top: 10px;
            font-style: italic;
        }

        .results-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .results-recommendation {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }

        .results-recommendation h4 {
            color: var(--primary-dark);
            margin-bottom: 12px;
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
        }

        .recommendation-item:last-child {
            margin-bottom: 0;
        }

        .rec-number {
            width: 24px;
            height: 24px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .rec-text {
            color: var(--gray-700);
            line-height: 1.5;
        }

        /* ==================== KANBAN BOARD STYLES ==================== */
        .kanban-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .add-task-form {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .add-task-input {
            padding: 12px 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 1rem;
            min-width: 250px;
            backdrop-filter: blur(10px);
        }

        .add-task-input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .add-task-input:focus {
            outline: none;
            border-color: white;
            background: rgba(255,255,255,0.3);
        }

        .add-task-btn {
            padding: 12px 25px;
            background: white;
            border: none;
            border-radius: 10px;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-task-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .kanban-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        @media (max-width: 1200px) {
            .kanban-board {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .kanban-board {
                grid-template-columns: 1fr;
            }
        }

        .kanban-column {
            background: rgba(255,255,255,0.95);
            border-radius: 16px;
            padding: 20px;
            min-height: 400px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid;
        }

        .column-header h3 {
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .task-count {
            background: var(--gray-200);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        .column-backlog .column-header { border-color: var(--gray-400); }
        .column-backlog .column-header h3 { color: var(--gray-600); }

        .column-todo .column-header { border-color: var(--primary); }
        .column-todo .column-header h3 { color: var(--primary); }

        .column-progress .column-header { border-color: var(--warning); }
        .column-progress .column-header h3 { color: var(--warning); }

        .column-done .column-header { border-color: var(--success); }
        .column-done .column-header h3 { color: var(--success); }

        .task-list {
            min-height: 300px;
        }

        .task-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: grab;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .task-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .task-card.dragging {
            opacity: 0.5;
            transform: rotate(3deg);
        }

        .task-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
        }

        .task-title {
            font-weight: 600;
            color: var(--gray-800);
            flex: 1;
            word-break: break-word;
        }

        .task-actions {
            display: flex;
            gap: 5px;
        }

        .task-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .task-btn-edit {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .task-btn-edit:hover {
            background: var(--primary);
            color: white;
        }

        .task-btn-delete {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .task-btn-delete:hover {
            background: var(--danger);
            color: white;
        }

        .task-meta {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .task-priority {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .priority-high {
            background: #fef2f2;
            color: var(--danger);
        }

        .priority-medium {
            background: #fffbeb;
            color: var(--warning);
        }

        .priority-low {
            background: #f0fdf4;
            color: var(--success);
        }

        .task-date {
            padding: 4px 10px;
            background: var(--gray-100);
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        .drop-zone {
            border: 2px dashed var(--gray-300);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            color: var(--gray-400);
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
            color: var(--primary);
        }

        /* Priority Select */
        .priority-select {
            padding: 10px 15px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        .priority-select option {
            color: var(--gray-900);
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255,255,255,0.2);
            padding: 15px 25px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: white;
        }

        .stat-label {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.8);
            margin-top: 5px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal h2 {
            margin-bottom: 20px;
            color: var(--gray-900);
        }

        .modal-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .modal-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-cancel {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .modal-btn-save {
            background: var(--primary);
            color: white;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        .modal-textarea {
            min-height: 60px;
            resize: vertical;
        }

        .task-link {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #eff6ff;
            color: var(--primary);
            border-radius: 20px;
            font-size: 0.75rem;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .task-link:hover {
            background: var(--primary);
            color: white;
        }

        .task-notes {
            font-size: 0.8rem;
            color: var(--gray-500);
            margin-top: 8px;
            padding: 8px;
            background: var(--gray-50);
            border-radius: 6px;
            border-left: 3px solid var(--gray-300);
        }

        /* ==================== SETTINGS STYLES ==================== */
        .settings-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1000px) {
            .settings-container {
                grid-template-columns: 1fr;
            }
        }

        .settings-container .card:first-child {
            grid-column: 1 / -1;
        }

        .setup-list {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }

        .setup-list li {
            padding: 8px 0;
            padding-left: 10px;
            border-left: 3px solid var(--primary);
            margin-bottom: 5px;
            background: var(--gray-50);
            border-radius: 0 8px 8px 0;
        }

        .setup-steps {
            background: var(--gray-50);
            padding: 20px;
            border-radius: 12px;
        }

        .setup-step {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px dashed var(--gray-300);
        }

        .setup-step:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .step-number {
            width: 36px;
            height: 36px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content strong {
            display: block;
            color: var(--gray-900);
            margin-bottom: 5px;
        }

        .step-content p {
            color: var(--gray-600);
            font-size: 0.9rem;
            margin: 0;
        }

        .code-block {
            display: block;
            background: var(--gray-800);
            color: #10b981;
            padding: 12px 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.8rem;
            margin-top: 10px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .apps-script-code {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border: 2px solid var(--primary);
        }

        .apps-script-code h4 {
            margin-bottom: 10px;
        }

        .script-note {
            color: var(--gray-600);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .script-code {
            max-height: 400px;
            overflow-y: auto;
            font-size: 0.75rem;
            line-height: 1.4;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-hint {
            font-size: 0.8rem;
            color: var(--gray-500);
            margin-top: 5px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: var(--gray-50);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .connection-status.connected {
            background: #ecfdf5;
        }

        .connection-status.error {
            background: #fef2f2;
        }

        .status-icon {
            font-size: 1.5rem;
        }

        .status-text {
            color: var(--gray-600);
        }

        .connection-status.connected .status-text {
            color: #047857;
        }

        .connection-status.error .status-text {
            color: #b91c1c;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .sync-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sync-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--gray-50);
            border-radius: 12px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .sync-info h4 {
            color: var(--gray-900);
            margin-bottom: 5px;
        }

        .sync-info p {
            font-size: 0.85rem;
            color: var(--gray-500);
            margin: 0;
        }

        .sync-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-sync {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-sync:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-sync-alt {
            background: var(--success);
        }

        .btn-sync-alt:hover {
            background: #059669;
        }

        .btn-sync:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
            transform: none;
        }

        .sync-icon {
            font-size: 1.1rem;
        }

        .sync-log {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid var(--gray-100);
        }

        .sync-log h4 {
            margin-bottom: 15px;
            color: var(--gray-800);
        }

        .log-entries {
            max-height: 200px;
            overflow-y: auto;
            background: var(--gray-50);
            border-radius: 10px;
            padding: 15px;
        }

        .log-entry {
            display: flex;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.85rem;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-time {
            color: var(--gray-500);
            white-space: nowrap;
        }

        .log-message {
            color: var(--gray-700);
        }

        .log-message.success {
            color: var(--success);
        }

        .log-message.error {
            color: var(--danger);
        }

        .log-empty {
            text-align: center;
            color: var(--gray-400);
            padding: 20px;
        }

        .auto-sync-settings {
            padding: 10px 0;
        }

        .toggle-group {
            margin-bottom: 15px;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 12px 15px;
            background: var(--gray-50);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .toggle-label:hover {
            background: var(--gray-100);
        }

        .toggle-label input {
            display: none;
        }

        .toggle-slider {
            width: 50px;
            height: 26px;
            background: var(--gray-300);
            border-radius: 13px;
            position: relative;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .toggle-slider::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .toggle-label input:checked + .toggle-slider {
            background: var(--success);
        }

        .toggle-label input:checked + .toggle-slider::after {
            left: 26px;
        }

        .toggle-text {
            color: var(--gray-700);
            font-size: 0.95rem;
        }

        .auto-sync-note {
            font-size: 0.85rem;
            color: var(--warning);
            margin-top: 15px;
            padding: 10px 15px;
            background: #fffbeb;
            border-radius: 8px;
            border-left: 3px solid var(--warning);
        }

        /* Footer */
        footer {
            text-align: center;
            color: rgba(255,255,255,0.7);
            margin-top: 40px;
            padding: 20px;
        }

        /* Icon colors */
        .icon-tahajud { background: linear-gradient(135deg, #1e3a8a, #3b82f6); color: white; }
        .icon-morning { background: linear-gradient(135deg, #f59e0b, #fbbf24); color: white; }
        .icon-work { background: linear-gradient(135deg, #059669, #10b981); color: white; }
        .icon-evening { background: linear-gradient(135deg, #7c3aed, #a78bfa); color: white; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ Sync Planner + Kanban</h1>
            <p>Integrasi Perencanaan Harian & Manajemen Tugas</p>
        </header>

        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('planner')">üìÖ Sync Planner</button>
            <button class="nav-tab" onclick="switchTab('pairwise')">‚öñÔ∏è Prioritas Fokus</button>
            <button class="nav-tab" onclick="switchTab('kanban')">üìã Kanban Board</button>
            <button class="nav-tab" onclick="switchTab('settings')">‚öôÔ∏è Google Sheets</button>
        </nav>

        <!-- SYNC PLANNER TAB -->
        <div id="planner-tab" class="tab-content active">
            <div class="planner-grid">
                <!-- Morning Routine -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-tahajud">üåô</div>
                        <h2 class="card-title">Rutinitas Tahajud & Subuh</h2>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">03:30</span>
                        <div class="time-content">
                            <div class="time-title">Bangun Tahajud</div>
                            <div class="time-desc">Wudhu, sholat tahajud 2-8 rakaat</div>
                        </div>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">04:00</span>
                        <div class="time-content">
                            <div class="time-title">Dzikir & Doa</div>
                            <div class="time-desc">Istighfar, tasbih, tawakkal</div>
                        </div>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">04:30</span>
                        <div class="time-content">
                            <div class="time-title">Sholat Subuh</div>
                            <div class="time-desc">Berjamaah + dzikir pagi</div>
                        </div>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">05:00</span>
                        <div class="time-content">
                            <div class="time-title">Refleksi Stoic</div>
                            <div class="time-desc">Premeditatio malorum, journaling</div>
                        </div>
                    </div>
                </div>

                <!-- Daily Checklist -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-morning">‚òÄÔ∏è</div>
                        <h2 class="card-title">Checklist Harian</h2>
                    </div>
                    
                    <div id="checklist-container">
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox">‚úì</div>
                            <span class="check-text">Tahajud minimal 2 rakaat</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox">‚úì</div>
                            <span class="check-text">Sholat Subuh berjamaah</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox">‚úì</div>
                            <span class="check-text">Dzikir pagi</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox">‚úì</div>
                            <span class="check-text">Olahraga 15-30 menit</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox">‚úì</div>
                            <span class="check-text">3 MIT (Most Important Tasks)</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox">‚úì</div>
                            <span class="check-text">Sholat 5 waktu lengkap</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox">‚úì</div>
                            <span class="check-text">Dzikir petang</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox">‚úì</div>
                            <span class="check-text">Evaluasi hari (Sedona Method)</span>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-header">
                            <span>Progress Hari Ini</span>
                            <span id="progress-text">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Work Block -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-work">üíº</div>
                        <h2 class="card-title">Blok Kerja</h2>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">07:30</span>
                        <div class="time-content">
                            <div class="time-title">Persiapan Kerja</div>
                            <div class="time-desc">Review agenda, prioritas MIT</div>
                        </div>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">08:00</span>
                        <div class="time-content">
                            <div class="time-title">Deep Work Session 1</div>
                            <div class="time-desc">Fokus pada tugas prioritas tinggi</div>
                        </div>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">10:00</span>
                        <div class="time-content">
                            <div class="time-title">Break & Sholat Dhuha</div>
                            <div class="time-desc">Istirahat, sholat dhuha 2-4 rakaat</div>
                        </div>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">10:30</span>
                        <div class="time-content">
                            <div class="time-title">Deep Work Session 2</div>
                            <div class="time-desc">Lanjutkan tugas atau meeting</div>
                        </div>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">12:00</span>
                        <div class="time-content">
                            <div class="time-title">Sholat Dzuhur & Istirahat</div>
                            <div class="time-desc">Makan siang, power nap</div>
                        </div>
                    </div>
                    
                    <div class="time-block">
                        <span class="time-label">13:30</span>
                        <div class="time-content">
                            <div class="time-title">Deep Work Session 3</div>
                            <div class="time-desc">Administrative tasks</div>
                        </div>
                    </div>
                </div>

                <!-- Evening Reflection -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon icon-evening">üåÖ</div>
                        <h2 class="card-title">Refleksi Malam</h2>
                    </div>
                    
                    <div class="reflection-group">
                        <label class="reflection-label">üéØ 3 Hal yang Berjalan Baik:</label>
                        <textarea class="reflection-textarea" placeholder="1. ...&#10;2. ...&#10;3. ..."></textarea>
                    </div>
                    
                    <div class="reflection-group">
                        <label class="reflection-label">üîÑ Yang Bisa Diperbaiki:</label>
                        <textarea class="reflection-textarea" placeholder="Apa yang bisa dilakukan lebih baik besok?"></textarea>
                    </div>
                    
                    <div class="reflection-group">
                        <label class="reflection-label">üôè Syukur Hari Ini:</label>
                        <textarea class="reflection-textarea" placeholder="Alhamdulillah untuk..."></textarea>
                    </div>
                    
                    <div class="reflection-group">
                        <label class="reflection-label">üí≠ Sedona Release:</label>
                        <textarea class="reflection-textarea" placeholder="Emosi yang perlu dilepaskan...&#10;Bisakah saya melepaskannya? Ya/Tidak&#10;Kapan? Sekarang."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- PAIRWISE COMPARISON TAB -->
        <div id="pairwise-tab" class="tab-content">
            <div class="pairwise-container">
                <!-- Instructions Card -->
                <div class="card pairwise-guide">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">üìñ</div>
                        <h2 class="card-title">Panduan Metode Pairwise Comparison</h2>
                    </div>
                    
                    <div class="guide-content">
                        <div class="guide-section">
                            <h4>üéØ Apa itu Pairwise Comparison?</h4>
                            <p>Metode membandingkan setiap opsi secara berpasangan untuk menentukan prioritas. Dengan membandingkan satu per satu, keputusan menjadi lebih objektif karena fokus hanya pada dua pilihan sekaligus.</p>
                        </div>
                        
                        <div class="guide-section">
                            <h4>üìã Cara Menggunakan:</h4>
                            <ol class="guide-steps">
                                <li><strong>Input Opsi:</strong> Masukkan 3-8 tugas/fokus yang ingin diprioritaskan</li>
                                <li><strong>Bandingkan:</strong> Untuk setiap pasangan, pilih mana yang LEBIH PENTING</li>
                                <li><strong>Kriteria:</strong> Pertimbangkan urgency, impact, dan alignment dengan tujuan</li>
                                <li><strong>Hasil:</strong> Sistem akan menghitung skor dan mengurutkan prioritas</li>
                            </ol>
                        </div>
                        
                        <div class="guide-section">
                            <h4>üí° Tips Memilih:</h4>
                            <div class="tips-grid">
                                <div class="tip-item">
                                    <span class="tip-icon">‚è∞</span>
                                    <div>
                                        <strong>Urgency</strong>
                                        <p>Mana yang deadline-nya lebih dekat?</p>
                                    </div>
                                </div>
                                <div class="tip-item">
                                    <span class="tip-icon">üí•</span>
                                    <div>
                                        <strong>Impact</strong>
                                        <p>Mana yang dampaknya lebih besar?</p>
                                    </div>
                                </div>
                                <div class="tip-item">
                                    <span class="tip-icon">üéØ</span>
                                    <div>
                                        <strong>Alignment</strong>
                                        <p>Mana yang lebih selaras dengan tujuan utama?</p>
                                    </div>
                                </div>
                                <div class="tip-item">
                                    <span class="tip-icon">ü§≤</span>
                                    <div>
                                        <strong>Barakah</strong>
                                        <p>Mana yang lebih bernilai akhirat?</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="guide-section islamic-reminder">
                            <h4>üïå Refleksi Islami</h4>
                            <p><em>"Dan bahwasanya seorang manusia tiada memperoleh selain apa yang telah diusahakannya."</em> (QS. An-Najm: 39)</p>
                            <p>Sebelum memilih, niatkan bahwa prioritas ini untuk ibadah dan kemaslahatan. Istikharah dalam hati sebelum setiap pilihan.</p>
                        </div>
                    </div>
                </div>

                <!-- Input Options Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">üìù</div>
                        <h2 class="card-title">Input Opsi Fokus</h2>
                    </div>
                    
                    <div class="options-input-area">
                        <div class="input-row">
                            <input type="text" id="new-option-input" class="option-input" placeholder="Masukkan tugas/fokus (tekan Enter atau klik Tambah)">
                            <button class="btn-add-option" onclick="addOption()">+ Tambah</button>
                        </div>
                        
                        <div class="options-list" id="options-list">
                            <!-- Options will be rendered here -->
                        </div>
                        
                        <div class="options-actions">
                            <span class="options-count">Opsi: <strong id="options-count">0</strong>/8 (minimal 3)</span>
                            <div class="action-buttons">
                                <button class="btn-secondary" onclick="clearAllOptions()">üóëÔ∏è Reset</button>
                                <button class="btn-primary" onclick="startComparison()" id="btn-start">‚ñ∂Ô∏è Mulai Perbandingan</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comparison Area -->
                <div class="card comparison-card" id="comparison-card" style="display: none;">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">‚öñÔ∏è</div>
                        <h2 class="card-title">Perbandingan Berpasangan</h2>
                    </div>
                    
                    <div class="comparison-progress">
                        <div class="progress-info">
                            <span>Perbandingan <strong id="current-comparison">1</strong> dari <strong id="total-comparisons">0</strong></span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="comparison-progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="comparison-question">
                        <p class="question-text">Mana yang LEBIH PENTING untuk difokuskan?</p>
                        <p class="question-hint">Pertimbangkan: urgency, impact, alignment dengan tujuan</p>
                    </div>
                    
                    <div class="comparison-options">
                        <button class="compare-btn" id="compare-btn-a" onclick="selectOption('a')">
                            <span class="compare-label">A</span>
                            <span class="compare-text" id="option-a-text">Opsi A</span>
                        </button>
                        
                        <div class="vs-divider">VS</div>
                        
                        <button class="compare-btn" id="compare-btn-b" onclick="selectOption('b')">
                            <span class="compare-label">B</span>
                            <span class="compare-text" id="option-b-text">Opsi B</span>
                        </button>
                    </div>
                    
                    <div class="comparison-nav">
                        <button class="btn-secondary" onclick="previousComparison()" id="btn-prev" disabled>‚Üê Sebelumnya</button>
                        <button class="btn-secondary" onclick="skipComparison()">Sama Penting (Skip)</button>
                    </div>
                </div>

                <!-- Results Card -->
                <div class="card results-card" id="results-card" style="display: none;">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">üèÜ</div>
                        <h2 class="card-title">Hasil Prioritas Fokus</h2>
                    </div>
                    
                    <div class="results-summary">
                        <p>Berdasarkan <strong id="result-comparisons">0</strong> perbandingan, berikut urutan prioritas Anda:</p>
                    </div>
                    
                    <div class="results-list" id="results-list">
                        <!-- Results will be rendered here -->
                    </div>
                    
                    <div class="results-matrix-toggle">
                        <button class="btn-secondary" onclick="toggleMatrix()">üìä Lihat Matrix Perbandingan</button>
                    </div>
                    
                    <div class="results-matrix" id="results-matrix" style="display: none;">
                        <h4>Matrix Perbandingan</h4>
                        <div class="matrix-container" id="matrix-container">
                            <!-- Matrix will be rendered here -->
                        </div>
                        <p class="matrix-note">* Angka menunjukkan berapa kali opsi di baris mengalahkan opsi di kolom</p>
                    </div>
                    
                    <div class="results-actions">
                        <button class="btn-secondary" onclick="resetComparison()">üîÑ Ulangi Perbandingan</button>
                        <button class="btn-primary" onclick="applyToKanban()">üìã Terapkan ke Kanban</button>
                    </div>
                    
                    <div class="results-recommendation">
                        <h4>üí° Rekomendasi Aksi:</h4>
                        <div id="recommendation-text">
                            <!-- Recommendation will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- KANBAN BOARD TAB -->
        <div id="kanban-tab" class="tab-content">
            <div class="kanban-header">
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-number" id="stat-total">0</div>
                        <div class="stat-label">Total Tugas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="stat-progress">0</div>
                        <div class="stat-label">Dalam Proses</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="stat-done">0</div>
                        <div class="stat-label">Selesai</div>
                    </div>
                </div>
            </div>

            <div class="add-task-form">
                <input type="text" id="new-task-input" class="add-task-input" placeholder="Tambah tugas baru...">
                <input type="url" id="new-task-link" class="add-task-input" placeholder="Link file (opsional)" style="min-width: 200px;">
                <select id="new-task-priority" class="priority-select">
                    <option value="low">üü¢ Rendah</option>
                    <option value="medium" selected>üü° Sedang</option>
                    <option value="high">üî¥ Tinggi</option>
                </select>
                <button class="add-task-btn" onclick="addTask()">+ Tambah Tugas</button>
            </div>

            <div class="kanban-board">
                <!-- Backlog Column -->
                <div class="kanban-column column-backlog">
                    <div class="column-header">
                        <h3>üì• Backlog</h3>
                        <span class="task-count" id="count-backlog">0</span>
                    </div>
                    <div class="task-list" id="backlog" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                        <div class="drop-zone">Seret tugas ke sini</div>
                    </div>
                </div>

                <!-- To Do Column -->
                <div class="kanban-column column-todo">
                    <div class="column-header">
                        <h3>üìã To Do</h3>
                        <span class="task-count" id="count-todo">0</span>
                    </div>
                    <div class="task-list" id="todo" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                        <div class="drop-zone">Seret tugas ke sini</div>
                    </div>
                </div>

                <!-- In Progress Column -->
                <div class="kanban-column column-progress">
                    <div class="column-header">
                        <h3>üîÑ In Progress</h3>
                        <span class="task-count" id="count-progress">0</span>
                    </div>
                    <div class="task-list" id="progress" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                        <div class="drop-zone">Seret tugas ke sini</div>
                    </div>
                </div>

                <!-- Done Column -->
                <div class="kanban-column column-done">
                    <div class="column-header">
                        <h3>‚úÖ Done</h3>
                        <span class="task-count" id="count-done">0</span>
                    </div>
                    <div class="task-list" id="done" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                        <div class="drop-zone">Seret tugas ke sini</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SETTINGS TAB - Google Sheets Integration -->
        <div id="settings-tab" class="tab-content">
            <div class="settings-container">
                <!-- Setup Guide Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #34a853, #4caf50);">üìä</div>
                        <h2 class="card-title">Integrasi Google Sheets</h2>
                    </div>
                    
                    <div class="guide-content">
                        <div class="guide-section">
                            <h4>üéØ Mengapa Perlu Google Sheets?</h4>
                            <p>Menyimpan data ke Google Sheets memungkinkan Anda untuk:</p>
                            <ul class="setup-list">
                                <li>üìà Melacak progress harian dan mingguan</li>
                                <li>üìä Membuat grafik dan analisis produktivitas</li>
                                <li>üîÑ Sinkronisasi antar perangkat</li>
                                <li>üìÖ Melihat histori dan pola kebiasaan</li>
                                <li>ü§ù Berbagi dengan mentor atau tim</li>
                            </ul>
                        </div>
                        
                        <div class="guide-section setup-steps">
                            <h4>üìù Cara Setup (5 Menit)</h4>
                            
                            <div class="setup-step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <strong>Buat Google Sheet Baru</strong>
                                    <p>Buka <a href="https://sheets.google.com" target="_blank">Google Sheets</a> dan buat spreadsheet baru dengan nama "Sync Planner Data"</p>
                                </div>
                            </div>
                            
                            <div class="setup-step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <strong>Buat 3 Sheet (Tab)</strong>
                                    <p>Rename dan tambah sheet dengan nama: <code>DailyLog</code>, <code>Kanban</code>, <code>Pairwise</code></p>
                                </div>
                            </div>
                            
                            <div class="setup-step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <strong>Setup Header untuk DailyLog</strong>
                                    <p>Di baris pertama sheet DailyLog, masukkan header:</p>
                                    <code class="code-block">Tanggal | Tahajud | Subuh | Dzikir Pagi | Olahraga | 3 MIT | Sholat 5 Waktu | Dzikir Petang | Evaluasi | Progress % | Hal Baik | Perbaikan | Syukur | Sedona Release</code>
                                </div>
                            </div>
                            
                            <div class="setup-step">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <strong>Setup Header untuk Kanban</strong>
                                    <p>Di baris pertama sheet Kanban, masukkan header:</p>
                                    <code class="code-block">ID | Judul | Prioritas | Status | Link File | Catatan | Tanggal Dibuat | Tanggal Update</code>
                                </div>
                            </div>
                            
                            <div class="setup-step">
                                <div class="step-number">5</div>
                                <div class="step-content">
                                    <strong>Setup Header untuk Pairwise</strong>
                                    <p>Di baris pertama sheet Pairwise, masukkan header:</p>
                                    <code class="code-block">Tanggal | Opsi | Ranking | Skor | Total Perbandingan</code>
                                </div>
                            </div>
                            
                            <div class="setup-step">
                                <div class="step-number">6</div>
                                <div class="step-content">
                                    <strong>Deploy Web App (Google Apps Script)</strong>
                                    <p>Buka Extensions ‚Üí Apps Script, paste kode di bawah, lalu Deploy sebagai Web App</p>
                                    <button class="btn-secondary" onclick="toggleAppsScript()">üìÑ Lihat Kode Apps Script</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="apps-script-code" id="apps-script-code" style="display: none;">
                            <h4>üîß Google Apps Script Code</h4>
                            <p class="script-note">Copy kode ini ke Apps Script editor di Google Sheets Anda:</p>
                            <pre class="code-block script-code">
// Sync Planner Google Sheets Integration
// Deploy as Web App dengan akses "Anyone"

const SPREADSHEET_ID = 'YOUR_SPREADSHEET_ID'; // Ganti dengan ID spreadsheet Anda

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    
    if (data.type === 'daily') {
      saveDailyLog(ss, data);
    } else if (data.type === 'kanban') {
      saveKanban(ss, data);
    } else if (data.type === 'pairwise') {
      savePairwise(ss, data);
    }
    
    return ContentService.createTextOutput(JSON.stringify({success: true}))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({success: false, error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet(e) {
  try {
    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    const type = e.parameter.type;
    let data = {};
    
    if (type === 'kanban') {
      data = getKanbanData(ss);
    } else if (type === 'daily') {
      data = getDailyData(ss, e.parameter.date);
    }
    
    return ContentService.createTextOutput(JSON.stringify({success: true, data: data}))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({success: false, error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function saveDailyLog(ss, data) {
  const sheet = ss.getSheetByName('DailyLog');
  const today = data.date || new Date().toLocaleDateString('id-ID');
  
  // Check if today's entry exists
  const dataRange = sheet.getDataRange();
  const values = dataRange.getValues();
  let rowIndex = -1;
  
  for (let i = 1; i < values.length; i++) {
    if (values[i][0] === today) {
      rowIndex = i + 1;
      break;
    }
  }
  
  const rowData = [
    today,
    data.checklist[0] ? '‚úì' : '',
    data.checklist[1] ? '‚úì' : '',
    data.checklist[2] ? '‚úì' : '',
    data.checklist[3] ? '‚úì' : '',
    data.checklist[4] ? '‚úì' : '',
    data.checklist[5] ? '‚úì' : '',
    data.checklist[6] ? '‚úì' : '',
    data.checklist[7] ? '‚úì' : '',
    data.progress + '%',
    data.reflections.good || '',
    data.reflections.improve || '',
    data.reflections.gratitude || '',
    data.reflections.sedona || ''
  ];
  
  if (rowIndex > 0) {
    sheet.getRange(rowIndex, 1, 1, rowData.length).setValues([rowData]);
  } else {
    sheet.appendRow(rowData);
  }
}

function saveKanban(ss, data) {
  const sheet = ss.getSheetByName('Kanban');
  
  // Clear existing data (except header)
  const lastRow = sheet.getLastRow();
  if (lastRow > 1) {
    sheet.getRange(2, 1, lastRow - 1, 8).clear();
  }
  
  // Add all tasks
  const rows = data.tasks.map(task => [
    task.id,
    task.title,
    task.priority,
    task.column,
    task.link || '',
    task.notes || '',
    task.createdAt,
    new Date().toLocaleDateString('id-ID')
  ]);
  
  if (rows.length > 0) {
    sheet.getRange(2, 1, rows.length, 8).setValues(rows);
  }
}

function savePairwise(ss, data) {
  const sheet = ss.getSheetByName('Pairwise');
  const today = new Date().toLocaleDateString('id-ID');
  
  const rows = data.results.map(result => [
    today,
    result.text,
    result.rank,
    result.score,
    data.totalComparisons
  ]);
  
  if (rows.length > 0) {
    rows.forEach(row => sheet.appendRow(row));
  }
}

function getKanbanData(ss) {
  const sheet = ss.getSheetByName('Kanban');
  const dataRange = sheet.getDataRange();
  const values = dataRange.getValues();
  
  if (values.length <= 1) return { tasks: [] };
  
  const tasks = [];
  for (let i = 1; i < values.length; i++) {
    if (values[i][0]) {
      tasks.push({
        id: values[i][0],
        title: values[i][1],
        priority: values[i][2],
        column: values[i][3],
        link: values[i][4],
        notes: values[i][5],
        createdAt: values[i][6]
      });
    }
  }
  
  return { tasks: tasks };
}

function getDailyData(ss, date) {
  const sheet = ss.getSheetByName('DailyLog');
  const dataRange = sheet.getDataRange();
  const values = dataRange.getValues();
  
  for (let i = 1; i < values.length; i++) {
    if (values[i][0] === date) {
      return {
        checklist: [
          values[i][1] === '‚úì',
          values[i][2] === '‚úì',
          values[i][3] === '‚úì',
          values[i][4] === '‚úì',
          values[i][5] === '‚úì',
          values[i][6] === '‚úì',
          values[i][7] === '‚úì',
          values[i][8] === '‚úì'
        ],
        reflections: {
          good: values[i][10],
          improve: values[i][11],
          gratitude: values[i][12],
          sedona: values[i][13]
        }
      };
    }
  }
  
  return null;
}</pre>
                            <button class="btn-primary" onclick="copyAppsScript()">üìã Copy Kode</button>
                        </div>
                    </div>
                </div>

                <!-- Connection Settings Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #4285f4, #34a853);">üîó</div>
                        <h2 class="card-title">Pengaturan Koneksi</h2>
                    </div>
                    
                    <div class="settings-form">
                        <div class="form-group">
                            <label class="form-label">Web App URL (dari Google Apps Script)</label>
                            <input type="url" id="gsheet-url" class="form-input" placeholder="https://script.google.com/macros/s/xxxxx/exec">
                            <p class="form-hint">Dapatkan URL ini setelah Deploy Web App di Apps Script</p>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Spreadsheet ID</label>
                            <input type="text" id="gsheet-id" class="form-input" placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                            <p class="form-hint">ID ada di URL spreadsheet: docs.google.com/spreadsheets/d/<strong>[ID_DISINI]</strong>/edit</p>
                        </div>
                        
                        <div class="connection-status" id="connection-status">
                            <span class="status-icon">‚ö™</span>
                            <span class="status-text">Belum terhubung</span>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn-secondary" onclick="testConnection()">üîç Test Koneksi</button>
                            <button class="btn-primary" onclick="saveGSheetSettings()">üíæ Simpan Pengaturan</button>
                        </div>
                    </div>
                </div>

                <!-- Sync Actions Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #fbbc04, #f9ab00);">üîÑ</div>
                        <h2 class="card-title">Sinkronisasi Data</h2>
                    </div>
                    
                    <div class="sync-actions">
                        <div class="sync-item">
                            <div class="sync-info">
                                <h4>üìÖ Sync Planner Hari Ini</h4>
                                <p>Simpan checklist dan refleksi hari ini ke Google Sheets</p>
                            </div>
                            <button class="btn-sync" onclick="syncDailyToSheet()">
                                <span class="sync-icon">üì§</span> Sync ke Sheet
                            </button>
                        </div>
                        
                        <div class="sync-item">
                            <div class="sync-info">
                                <h4>üìã Kanban Board</h4>
                                <p>Sinkronkan semua tugas Kanban ke Google Sheets</p>
                            </div>
                            <div class="sync-buttons">
                                <button class="btn-sync" onclick="syncKanbanToSheet()">
                                    <span class="sync-icon">üì§</span> Upload
                                </button>
                                <button class="btn-sync btn-sync-alt" onclick="loadKanbanFromSheet()">
                                    <span class="sync-icon">üì•</span> Download
                                </button>
                            </div>
                        </div>
                        
                        <div class="sync-item">
                            <div class="sync-info">
                                <h4>‚öñÔ∏è Hasil Pairwise</h4>
                                <p>Simpan hasil prioritas ke Google Sheets untuk analisis</p>
                            </div>
                            <button class="btn-sync" onclick="syncPairwiseToSheet()">
                                <span class="sync-icon">üì§</span> Sync ke Sheet
                            </button>
                        </div>
                    </div>
                    
                    <div class="sync-log" id="sync-log">
                        <h4>üìù Log Sinkronisasi</h4>
                        <div class="log-entries" id="log-entries">
                            <p class="log-empty">Belum ada aktivitas sinkronisasi</p>
                        </div>
                    </div>
                </div>

                <!-- Auto Sync Settings -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #9c27b0, #ba68c8);">‚è∞</div>
                        <h2 class="card-title">Auto Sync</h2>
                    </div>
                    
                    <div class="auto-sync-settings">
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <input type="checkbox" id="auto-sync-daily" onchange="toggleAutoSync('daily')">
                                <span class="toggle-slider"></span>
                                <span class="toggle-text">Auto sync Daily Log saat checklist berubah</span>
                            </label>
                        </div>
                        
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <input type="checkbox" id="auto-sync-kanban" onchange="toggleAutoSync('kanban')">
                                <span class="toggle-slider"></span>
                                <span class="toggle-text">Auto sync Kanban saat tugas berubah</span>
                            </label>
                        </div>
                        
                        <p class="auto-sync-note">‚ö†Ô∏è Auto sync memerlukan koneksi internet dan Web App URL yang valid</p>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Sync Planner + Kanban Board ¬© 2025 | Bismillah, Produktif dengan Barakah ü§≤</p>
        </footer>
    </div>

    <!-- PWA Install Banner -->
    <div class="pwa-install-banner" id="pwa-install-banner">
        <div class="pwa-install-info">
            <span class="pwa-install-icon">üéØ</span>
            <div class="pwa-install-text">
                <h4>Install Sync Planner</h4>
                <p>Akses lebih cepat seperti aplikasi native</p>
            </div>
        </div>
        <div class="pwa-install-actions">
            <button class="pwa-btn pwa-btn-dismiss" onclick="dismissPWABanner()">Nanti</button>
            <button class="pwa-btn pwa-btn-install" onclick="installPWA()">Install</button>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="edit-modal">
        <div class="modal">
            <h2>‚úèÔ∏è Edit Tugas</h2>
            <input type="text" id="edit-task-title" class="modal-input" placeholder="Judul tugas">
            <input type="url" id="edit-task-link" class="modal-input" placeholder="Link file (opsional) - Google Drive, Docs, dll">
            <textarea id="edit-task-notes" class="modal-input modal-textarea" placeholder="Catatan tambahan (opsional)"></textarea>
            <select id="edit-task-priority" class="modal-select">
                <option value="low">üü¢ Prioritas Rendah</option>
                <option value="medium">üü° Prioritas Sedang</option>
                <option value="high">üî¥ Prioritas Tinggi</option>
            </select>
            <select id="edit-task-column" class="modal-select">
                <option value="backlog">üì• Backlog</option>
                <option value="todo">üìã To Do</option>
                <option value="progress">üîÑ In Progress</option>
                <option value="done">‚úÖ Done</option>
            </select>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="closeModal()">Batal</button>
                <button class="modal-btn modal-btn-save" onclick="saveEdit()">Simpan</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== PAIRWISE COMPARISON FUNCTIONS ====================
        let pairwiseOptions = [];
        let comparisons = [];
        let currentComparisonIndex = 0;
        let comparisonResults = {}; // { "0-1": "a" or "b" or "tie" }
        let scores = {};

        function addOption() {
            const input = document.getElementById('new-option-input');
            const text = input.value.trim();
            
            if (!text) {
                input.focus();
                return;
            }
            
            if (pairwiseOptions.length >= 8) {
                alert('Maksimal 8 opsi yang dapat dibandingkan');
                return;
            }
            
            if (pairwiseOptions.includes(text)) {
                alert('Opsi sudah ada dalam daftar');
                input.focus();
                return;
            }
            
            pairwiseOptions.push(text);
            renderOptions();
            input.value = '';
            input.focus();
            updateStartButton();
            savePairwiseToLocalStorage();
        }

        function removeOption(index) {
            pairwiseOptions.splice(index, 1);
            renderOptions();
            updateStartButton();
            savePairwiseToLocalStorage();
        }

        function renderOptions() {
            const container = document.getElementById('options-list');
            document.getElementById('options-count').textContent = pairwiseOptions.length;
            
            if (pairwiseOptions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray-400); padding: 30px;">Belum ada opsi. Tambahkan minimal 3 opsi untuk memulai perbandingan.</p>';
                return;
            }
            
            container.innerHTML = pairwiseOptions.map((opt, i) => `
                <div class="option-item">
                    <span class="option-number">${i + 1}</span>
                    <span class="option-text">${escapeHtml(opt)}</span>
                    <button class="option-delete" onclick="removeOption(${i})">‚úï</button>
                </div>
            `).join('');
        }

        function updateStartButton() {
            const btn = document.getElementById('btn-start');
            btn.disabled = pairwiseOptions.length < 3;
        }

        function clearAllOptions() {
            if (pairwiseOptions.length === 0) return;
            if (!confirm('Hapus semua opsi?')) return;
            
            pairwiseOptions = [];
            renderOptions();
            updateStartButton();
            resetComparisonState();
            savePairwiseToLocalStorage();
        }

        function generateComparisons() {
            comparisons = [];
            for (let i = 0; i < pairwiseOptions.length; i++) {
                for (let j = i + 1; j < pairwiseOptions.length; j++) {
                    comparisons.push([i, j]);
                }
            }
            // Shuffle comparisons for more balanced decision making
            comparisons = comparisons.sort(() => Math.random() - 0.5);
        }

        function startComparison() {
            if (pairwiseOptions.length < 3) {
                alert('Minimal 3 opsi diperlukan');
                return;
            }
            
            generateComparisons();
            currentComparisonIndex = 0;
            comparisonResults = {};
            scores = {};
            pairwiseOptions.forEach((_, i) => scores[i] = 0);
            
            document.getElementById('comparison-card').style.display = 'block';
            document.getElementById('results-card').style.display = 'none';
            document.getElementById('total-comparisons').textContent = comparisons.length;
            
            showCurrentComparison();
            
            // Scroll to comparison card
            document.getElementById('comparison-card').scrollIntoView({ behavior: 'smooth' });
        }

        function showCurrentComparison() {
            if (currentComparisonIndex >= comparisons.length) {
                showResults();
                return;
            }
            
            const [indexA, indexB] = comparisons[currentComparisonIndex];
            const key = `${indexA}-${indexB}`;
            
            document.getElementById('current-comparison').textContent = currentComparisonIndex + 1;
            document.getElementById('option-a-text').textContent = pairwiseOptions[indexA];
            document.getElementById('option-b-text').textContent = pairwiseOptions[indexB];
            
            // Update progress
            const progress = ((currentComparisonIndex) / comparisons.length) * 100;
            document.getElementById('comparison-progress-fill').style.width = progress + '%';
            
            // Reset selection visual
            document.getElementById('compare-btn-a').classList.remove('selected');
            document.getElementById('compare-btn-b').classList.remove('selected');
            
            // Show previous selection if exists
            if (comparisonResults[key]) {
                if (comparisonResults[key] === 'a') {
                    document.getElementById('compare-btn-a').classList.add('selected');
                } else if (comparisonResults[key] === 'b') {
                    document.getElementById('compare-btn-b').classList.add('selected');
                }
            }
            
            // Update prev button
            document.getElementById('btn-prev').disabled = currentComparisonIndex === 0;
        }

        function selectOption(choice) {
            const [indexA, indexB] = comparisons[currentComparisonIndex];
            const key = `${indexA}-${indexB}`;
            
            comparisonResults[key] = choice;
            
            // Visual feedback
            document.getElementById('compare-btn-a').classList.toggle('selected', choice === 'a');
            document.getElementById('compare-btn-b').classList.toggle('selected', choice === 'b');
            
            // Auto advance after short delay
            setTimeout(() => {
                currentComparisonIndex++;
                showCurrentComparison();
            }, 300);
        }

        function skipComparison() {
            const [indexA, indexB] = comparisons[currentComparisonIndex];
            const key = `${indexA}-${indexB}`;
            comparisonResults[key] = 'tie';
            
            currentComparisonIndex++;
            showCurrentComparison();
        }

        function previousComparison() {
            if (currentComparisonIndex > 0) {
                currentComparisonIndex--;
                showCurrentComparison();
            }
        }

        function calculateScores() {
            // Reset scores
            pairwiseOptions.forEach((_, i) => scores[i] = 0);
            
            // Calculate based on comparison results
            for (const [key, result] of Object.entries(comparisonResults)) {
                const [indexA, indexB] = key.split('-').map(Number);
                
                if (result === 'a') {
                    scores[indexA] += 1;
                } else if (result === 'b') {
                    scores[indexB] += 1;
                } else if (result === 'tie') {
                    scores[indexA] += 0.5;
                    scores[indexB] += 0.5;
                }
            }
            
            return scores;
        }

        function showResults() {
            calculateScores();
            
            document.getElementById('comparison-card').style.display = 'none';
            document.getElementById('results-card').style.display = 'block';
            document.getElementById('result-comparisons').textContent = comparisons.length;
            
            // Sort options by score
            const sortedOptions = pairwiseOptions
                .map((opt, i) => ({ text: opt, index: i, score: scores[i] }))
                .sort((a, b) => b.score - a.score);
            
            const maxScore = Math.max(...sortedOptions.map(o => o.score));
            
            // Render results
            const resultsList = document.getElementById('results-list');
            resultsList.innerHTML = sortedOptions.map((opt, rank) => {
                const percentage = maxScore > 0 ? (opt.score / maxScore) * 100 : 0;
                const rankClass = rank < 3 ? `rank-${rank + 1}` : '';
                const medal = rank === 0 ? 'ü•á' : rank === 1 ? 'ü•à' : rank === 2 ? 'ü•â' : '';
                
                return `
                    <div class="result-item ${rankClass}">
                        <div class="result-rank">${medal || (rank + 1)}</div>
                        <div class="result-info">
                            <div class="result-title">${escapeHtml(opt.text)}</div>
                            <div class="result-score">Skor: ${opt.score} dari ${comparisons.length} perbandingan</div>
                        </div>
                        <div class="result-bar-container">
                            <div class="result-bar" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Render recommendations
            renderRecommendations(sortedOptions);
            
            // Render matrix
            renderMatrix();
            
            // Scroll to results
            document.getElementById('results-card').scrollIntoView({ behavior: 'smooth' });
            
            savePairwiseToLocalStorage();
        }

        function renderRecommendations(sortedOptions) {
            const container = document.getElementById('recommendation-text');
            const top3 = sortedOptions.slice(0, 3);
            
            let recommendations = [];
            
            if (top3[0]) {
                recommendations.push(`<strong>"${escapeHtml(top3[0].text)}"</strong> adalah prioritas utama Anda. Fokuskan energi terbaik di pagi hari untuk ini.`);
            }
            
            if (top3[1]) {
                recommendations.push(`<strong>"${escapeHtml(top3[1].text)}"</strong> bisa dikerjakan setelah prioritas utama selesai atau saat energi masih tinggi.`);
            }
            
            if (top3[2]) {
                recommendations.push(`<strong>"${escapeHtml(top3[2].text)}"</strong> bisa dijadwalkan di waktu dengan energi lebih rendah atau didelegasikan jika memungkinkan.`);
            }
            
            if (sortedOptions.length > 3) {
                recommendations.push(`Sisanya (${sortedOptions.length - 3} item) bisa masuk ke backlog Kanban dan dikerjakan sesuai kapasitas.`);
            }
            
            container.innerHTML = recommendations.map((rec, i) => `
                <div class="recommendation-item">
                    <span class="rec-number">${i + 1}</span>
                    <span class="rec-text">${rec}</span>
                </div>
            `).join('');
        }

        function renderMatrix() {
            const container = document.getElementById('matrix-container');
            
            let html = '<table><tr><th></th>';
            
            // Header row
            pairwiseOptions.forEach((opt, i) => {
                const shortName = opt.length > 15 ? opt.substring(0, 15) + '...' : opt;
                html += `<th title="${escapeHtml(opt)}">${escapeHtml(shortName)}</th>`;
            });
            html += '</tr>';
            
            // Data rows
            pairwiseOptions.forEach((optRow, i) => {
                const shortName = optRow.length > 15 ? optRow.substring(0, 15) + '...' : optRow;
                html += `<tr><th title="${escapeHtml(optRow)}">${escapeHtml(shortName)}</th>`;
                
                pairwiseOptions.forEach((optCol, j) => {
                    if (i === j) {
                        html += '<td class="diagonal">-</td>';
                    } else {
                        const key = i < j ? `${i}-${j}` : `${j}-${i}`;
                        const result = comparisonResults[key];
                        
                        let cellClass = '';
                        let cellValue = '-';
                        
                        if (result) {
                            if (i < j) {
                                if (result === 'a') {
                                    cellClass = 'win';
                                    cellValue = '‚úì';
                                } else if (result === 'b') {
                                    cellClass = 'lose';
                                    cellValue = '‚úó';
                                } else {
                                    cellClass = 'tie';
                                    cellValue = '=';
                                }
                            } else {
                                if (result === 'b') {
                                    cellClass = 'win';
                                    cellValue = '‚úì';
                                } else if (result === 'a') {
                                    cellClass = 'lose';
                                    cellValue = '‚úó';
                                } else {
                                    cellClass = 'tie';
                                    cellValue = '=';
                                }
                            }
                        }
                        
                        html += `<td class="${cellClass}">${cellValue}</td>`;
                    }
                });
                
                html += '</tr>';
            });
            
            html += '</table>';
            container.innerHTML = html;
        }

        function toggleMatrix() {
            const matrix = document.getElementById('results-matrix');
            matrix.style.display = matrix.style.display === 'none' ? 'block' : 'none';
        }

        function resetComparison() {
            currentComparisonIndex = 0;
            comparisonResults = {};
            document.getElementById('comparison-card').style.display = 'none';
            document.getElementById('results-card').style.display = 'none';
            document.getElementById('results-matrix').style.display = 'none';
        }

        function resetComparisonState() {
            resetComparison();
            comparisons = [];
            scores = {};
        }

        function applyToKanban() {
            calculateScores();
            
            // Sort options by score
            const sortedOptions = pairwiseOptions
                .map((opt, i) => ({ text: opt, index: i, score: scores[i] }))
                .sort((a, b) => b.score - a.score);
            
            // Add to Kanban as tasks
            sortedOptions.forEach((opt, rank) => {
                const priority = rank === 0 ? 'high' : rank < 3 ? 'medium' : 'low';
                const column = rank === 0 ? 'todo' : 'backlog';
                
                const task = {
                    id: taskIdCounter++,
                    title: opt.text,
                    priority: priority,
                    column: column,
                    createdAt: new Date().toLocaleDateString('id-ID')
                };
                
                tasks.push(task);
                renderTask(task);
            });
            
            updateCounts();
            saveToLocalStorage();
            
            alert(`${sortedOptions.length} tugas telah ditambahkan ke Kanban Board!\n\nPrioritas tertinggi sudah di kolom "To Do", sisanya di "Backlog".`);
            
            // Switch to Kanban tab
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.nav-tab')[2].classList.add('active');
            document.getElementById('kanban-tab').classList.add('active');
        }

        function savePairwiseToLocalStorage() {
            const data = {
                options: pairwiseOptions,
                results: comparisonResults,
                comparisons: comparisons,
                scores: scores
            };
            localStorage.setItem('syncPlannerPairwise', JSON.stringify(data));
        }

        function loadPairwiseFromLocalStorage() {
            const saved = localStorage.getItem('syncPlannerPairwise');
            if (!saved) return;
            
            try {
                const data = JSON.parse(saved);
                if (data.options) {
                    pairwiseOptions = data.options;
                    renderOptions();
                    updateStartButton();
                }
            } catch (e) {
                console.error('Error loading pairwise data:', e);
            }
        }

        // Enter key to add option
        document.getElementById('new-option-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addOption();
            }
        });

        // ==================== TAB SWITCHING ====================
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // ==================== CHECKLIST FUNCTIONS ====================
        function toggleCheck(item) {
            item.classList.toggle('checked');
            updateProgress();
            saveToLocalStorage();
            
            // Auto sync if enabled
            if (gsheetSettings.autoSyncDaily) {
                syncDailyToSheet();
            }
        }

        function updateProgress() {
            const items = document.querySelectorAll('.checklist-item');
            const checked = document.querySelectorAll('.checklist-item.checked');
            const percentage = Math.round((checked.length / items.length) * 100);
            
            document.getElementById('progress-fill').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = percentage + '%';
        }

        // ==================== KANBAN FUNCTIONS ====================
        let tasks = [];
        let taskIdCounter = 1;
        let editingTaskId = null;

        function addTask() {
            const input = document.getElementById('new-task-input');
            const linkInput = document.getElementById('new-task-link');
            const priority = document.getElementById('new-task-priority').value;
            const title = input.value.trim();
            const link = linkInput.value.trim();
            
            if (!title) {
                input.focus();
                return;
            }

            const task = {
                id: taskIdCounter++,
                title: title,
                link: link,
                notes: '',
                priority: priority,
                column: 'todo',
                createdAt: new Date().toLocaleDateString('id-ID')
            };

            tasks.push(task);
            renderTask(task);
            updateCounts();
            saveToLocalStorage();
            
            // Auto sync if enabled
            if (gsheetSettings.autoSyncKanban) {
                syncKanbanToSheet();
            }
            
            input.value = '';
            linkInput.value = '';
            input.focus();
        }

        function renderTask(task) {
            const taskCard = document.createElement('div');
            taskCard.className = 'task-card';
            taskCard.id = 'task-' + task.id;
            taskCard.draggable = true;
            taskCard.ondragstart = drag;
            taskCard.ondragend = dragEnd;

            const linkHtml = task.link ? `<a href="${escapeHtml(task.link)}" target="_blank" class="task-link" onclick="event.stopPropagation()">üîó File</a>` : '';
            const notesHtml = task.notes ? `<div class="task-notes">${escapeHtml(task.notes)}</div>` : '';

            taskCard.innerHTML = `
                <div class="task-card-header">
                    <span class="task-title">${escapeHtml(task.title)}</span>
                    <div class="task-actions">
                        <button class="task-btn task-btn-edit" onclick="editTask(${task.id})">‚úèÔ∏è</button>
                        <button class="task-btn task-btn-delete" onclick="deleteTask(${task.id})">üóëÔ∏è</button>
                    </div>
                </div>
                <div class="task-meta">
                    <span class="task-priority priority-${task.priority}">${getPriorityLabel(task.priority)}</span>
                    <span class="task-date">üìÖ ${task.createdAt}</span>
                    ${linkHtml}
                </div>
                ${notesHtml}
            `;

            const column = document.getElementById(task.column);
            const dropZone = column.querySelector('.drop-zone');
            if (dropZone) {
                column.insertBefore(taskCard, dropZone);
            } else {
                column.appendChild(taskCard);
            }
        }

        function getPriorityLabel(priority) {
            const labels = {
                low: 'üü¢ Rendah',
                medium: 'üü° Sedang',
                high: 'üî¥ Tinggi'
            };
            return labels[priority] || priority;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function deleteTask(taskId) {
            if (!confirm('Hapus tugas ini?')) return;
            
            tasks = tasks.filter(t => t.id !== taskId);
            const taskElement = document.getElementById('task-' + taskId);
            if (taskElement) {
                taskElement.remove();
            }
            updateCounts();
            saveToLocalStorage();
        }

        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            editingTaskId = taskId;
            document.getElementById('edit-task-title').value = task.title;
            document.getElementById('edit-task-link').value = task.link || '';
            document.getElementById('edit-task-notes').value = task.notes || '';
            document.getElementById('edit-task-priority').value = task.priority;
            document.getElementById('edit-task-column').value = task.column;
            document.getElementById('edit-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('edit-modal').classList.remove('active');
            editingTaskId = null;
        }

        function saveEdit() {
            if (!editingTaskId) return;

            const task = tasks.find(t => t.id === editingTaskId);
            if (!task) return;

            const newTitle = document.getElementById('edit-task-title').value.trim();
            const newLink = document.getElementById('edit-task-link').value.trim();
            const newNotes = document.getElementById('edit-task-notes').value.trim();
            const newPriority = document.getElementById('edit-task-priority').value;
            const newColumn = document.getElementById('edit-task-column').value;

            if (!newTitle) {
                alert('Judul tugas tidak boleh kosong');
                return;
            }

            // Remove from old position
            const taskElement = document.getElementById('task-' + editingTaskId);
            if (taskElement) {
                taskElement.remove();
            }

            // Update task data
            task.title = newTitle;
            task.link = newLink;
            task.notes = newNotes;
            task.priority = newPriority;
            task.column = newColumn;

            // Re-render task
            renderTask(task);
            updateCounts();
            saveToLocalStorage();
            
            // Auto sync if enabled
            if (gsheetSettings.autoSyncKanban) {
                syncKanbanToSheet();
            }
            
            closeModal();
        }

        // ==================== DRAG AND DROP ====================
        function drag(event) {
            event.target.classList.add('dragging');
            event.dataTransfer.setData('text/plain', event.target.id);
        }

        function dragEnd(event) {
            event.target.classList.remove('dragging');
        }

        function allowDrop(event) {
            event.preventDefault();
            const dropZone = event.currentTarget.querySelector('.drop-zone');
            if (dropZone) {
                dropZone.classList.add('drag-over');
            }
        }

        function dragLeave(event) {
            const dropZone = event.currentTarget.querySelector('.drop-zone');
            if (dropZone) {
                dropZone.classList.remove('drag-over');
            }
        }

        function drop(event) {
            event.preventDefault();
            const taskId = event.dataTransfer.getData('text/plain');
            const taskElement = document.getElementById(taskId);
            const targetColumn = event.currentTarget;
            
            // Remove drag-over state
            const dropZone = targetColumn.querySelector('.drop-zone');
            if (dropZone) {
                dropZone.classList.remove('drag-over');
                targetColumn.insertBefore(taskElement, dropZone);
            } else {
                targetColumn.appendChild(taskElement);
            }

            // Update task data
            const numericId = parseInt(taskId.replace('task-', ''));
            const task = tasks.find(t => t.id === numericId);
            if (task) {
                task.column = targetColumn.id;
            }

            updateCounts();
            saveToLocalStorage();
        }

        // ==================== UPDATE COUNTS ====================
        function updateCounts() {
            const columns = ['backlog', 'todo', 'progress', 'done'];
            let total = 0;
            let progressCount = 0;
            let doneCount = 0;

            columns.forEach(col => {
                const count = tasks.filter(t => t.column === col).length;
                document.getElementById('count-' + col).textContent = count;
                total += count;
                
                if (col === 'progress') progressCount = count;
                if (col === 'done') doneCount = count;
            });

            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-progress').textContent = progressCount;
            document.getElementById('stat-done').textContent = doneCount;
        }

        // ==================== LOCAL STORAGE ====================
        function saveToLocalStorage() {
            const data = {
                tasks: tasks,
                taskIdCounter: taskIdCounter,
                checklist: Array.from(document.querySelectorAll('.checklist-item')).map(item => item.classList.contains('checked')),
                reflections: {
                    good: document.querySelectorAll('.reflection-textarea')[0].value,
                    improve: document.querySelectorAll('.reflection-textarea')[1].value,
                    gratitude: document.querySelectorAll('.reflection-textarea')[2].value,
                    sedona: document.querySelectorAll('.reflection-textarea')[3].value
                }
            };
            localStorage.setItem('syncPlannerKanban', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('syncPlannerKanban');
            if (!saved) return;

            try {
                const data = JSON.parse(saved);
                
                // Load tasks
                if (data.tasks) {
                    tasks = data.tasks;
                    taskIdCounter = data.taskIdCounter || 1;
                    tasks.forEach(task => renderTask(task));
                    updateCounts();
                }

                // Load checklist
                if (data.checklist) {
                    const items = document.querySelectorAll('.checklist-item');
                    data.checklist.forEach((checked, index) => {
                        if (items[index] && checked) {
                            items[index].classList.add('checked');
                        }
                    });
                    updateProgress();
                }

                // Load reflections
                if (data.reflections) {
                    const textareas = document.querySelectorAll('.reflection-textarea');
                    textareas[0].value = data.reflections.good || '';
                    textareas[1].value = data.reflections.improve || '';
                    textareas[2].value = data.reflections.gratitude || '';
                    textareas[3].value = data.reflections.sedona || '';
                }
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }

        // Auto-save reflections
        document.querySelectorAll('.reflection-textarea').forEach(textarea => {
            textarea.addEventListener('input', saveToLocalStorage);
        });

        // Enter key to add task
        document.getElementById('new-task-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addTask();
            }
        });

        // Close modal on outside click
        document.getElementById('edit-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // ==================== GOOGLE SHEETS INTEGRATION ====================
        let gsheetSettings = {
            webAppUrl: '',
            spreadsheetId: '',
            autoSyncDaily: false,
            autoSyncKanban: false
        };

        function loadGSheetSettings() {
            const saved = localStorage.getItem('syncPlannerGSheet');
            if (saved) {
                try {
                    gsheetSettings = { ...gsheetSettings, ...JSON.parse(saved) };
                    document.getElementById('gsheet-url').value = gsheetSettings.webAppUrl || '';
                    document.getElementById('gsheet-id').value = gsheetSettings.spreadsheetId || '';
                    document.getElementById('auto-sync-daily').checked = gsheetSettings.autoSyncDaily;
                    document.getElementById('auto-sync-kanban').checked = gsheetSettings.autoSyncKanban;
                    
                    if (gsheetSettings.webAppUrl) {
                        updateConnectionStatus('connected', 'Pengaturan tersimpan');
                    }
                } catch (e) {
                    console.error('Error loading GSheet settings:', e);
                }
            }
        }

        function saveGSheetSettings() {
            gsheetSettings.webAppUrl = document.getElementById('gsheet-url').value.trim();
            gsheetSettings.spreadsheetId = document.getElementById('gsheet-id').value.trim();
            
            localStorage.setItem('syncPlannerGSheet', JSON.stringify(gsheetSettings));
            
            addLogEntry('Pengaturan Google Sheets disimpan', 'success');
            updateConnectionStatus('connected', 'Pengaturan tersimpan');
            alert('Pengaturan berhasil disimpan!');
        }

        function toggleAutoSync(type) {
            if (type === 'daily') {
                gsheetSettings.autoSyncDaily = document.getElementById('auto-sync-daily').checked;
            } else if (type === 'kanban') {
                gsheetSettings.autoSyncKanban = document.getElementById('auto-sync-kanban').checked;
            }
            localStorage.setItem('syncPlannerGSheet', JSON.stringify(gsheetSettings));
        }

        function updateConnectionStatus(status, message) {
            const statusEl = document.getElementById('connection-status');
            statusEl.className = 'connection-status ' + status;
            
            const icons = { connected: 'üü¢', error: 'üî¥', testing: 'üü°' };
            statusEl.querySelector('.status-icon').textContent = icons[status] || '‚ö™';
            statusEl.querySelector('.status-text').textContent = message;
        }

        async function testConnection() {
            const url = document.getElementById('gsheet-url').value.trim();
            
            if (!url) {
                alert('Masukkan Web App URL terlebih dahulu');
                return;
            }
            
            updateConnectionStatus('testing', 'Menguji koneksi...');
            
            try {
                const response = await fetch(url + '?type=test', {
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                // Since no-cors doesn't give us response data, we assume success if no error
                updateConnectionStatus('connected', 'Koneksi berhasil (mode no-cors)');
                addLogEntry('Test koneksi berhasil', 'success');
            } catch (error) {
                updateConnectionStatus('error', 'Koneksi gagal: ' + error.message);
                addLogEntry('Test koneksi gagal: ' + error.message, 'error');
            }
        }

        async function syncDailyToSheet() {
            if (!gsheetSettings.webAppUrl) {
                alert('Silakan setup Google Sheets terlebih dahulu di tab Settings');
                return;
            }
            
            const checklist = Array.from(document.querySelectorAll('.checklist-item')).map(item => 
                item.classList.contains('checked')
            );
            
            const textareas = document.querySelectorAll('.reflection-textarea');
            const progress = document.getElementById('progress-text').textContent;
            
            const data = {
                type: 'daily',
                date: new Date().toLocaleDateString('id-ID'),
                checklist: checklist,
                progress: parseInt(progress),
                reflections: {
                    good: textareas[0].value,
                    improve: textareas[1].value,
                    gratitude: textareas[2].value,
                    sedona: textareas[3].value
                }
            };
            
            try {
                addLogEntry('Mengirim data Daily Log...', '');
                
                await fetch(gsheetSettings.webAppUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                addLogEntry('Daily Log berhasil disync ke Google Sheets', 'success');
                alert('Data hari ini berhasil disimpan ke Google Sheets!');
            } catch (error) {
                addLogEntry('Gagal sync Daily Log: ' + error.message, 'error');
                alert('Gagal menyimpan: ' + error.message);
            }
        }

        async function syncKanbanToSheet() {
            if (!gsheetSettings.webAppUrl) {
                alert('Silakan setup Google Sheets terlebih dahulu di tab Settings');
                return;
            }
            
            const data = {
                type: 'kanban',
                tasks: tasks
            };
            
            try {
                addLogEntry('Mengirim data Kanban...', '');
                
                await fetch(gsheetSettings.webAppUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                addLogEntry('Kanban berhasil disync ke Google Sheets (' + tasks.length + ' tugas)', 'success');
                alert('Data Kanban berhasil disimpan ke Google Sheets!');
            } catch (error) {
                addLogEntry('Gagal sync Kanban: ' + error.message, 'error');
                alert('Gagal menyimpan: ' + error.message);
            }
        }

        async function loadKanbanFromSheet() {
            if (!gsheetSettings.webAppUrl) {
                alert('Silakan setup Google Sheets terlebih dahulu di tab Settings');
                return;
            }
            
            if (!confirm('Ini akan mengganti data Kanban lokal dengan data dari Google Sheets. Lanjutkan?')) {
                return;
            }
            
            try {
                addLogEntry('Mengambil data Kanban dari Google Sheets...', '');
                
                // Note: Due to CORS, this might not work directly. 
                // User needs to ensure their Apps Script is properly configured
                const response = await fetch(gsheetSettings.webAppUrl + '?type=kanban');
                const result = await response.json();
                
                if (result.success && result.data && result.data.tasks) {
                    // Clear current tasks display
                    document.querySelectorAll('.task-card').forEach(el => el.remove());
                    
                    // Load new tasks
                    tasks = result.data.tasks;
                    taskIdCounter = Math.max(...tasks.map(t => t.id), 0) + 1;
                    
                    tasks.forEach(task => renderTask(task));
                    updateCounts();
                    saveToLocalStorage();
                    
                    addLogEntry('Berhasil memuat ' + tasks.length + ' tugas dari Google Sheets', 'success');
                    alert('Data Kanban berhasil dimuat dari Google Sheets!');
                } else {
                    throw new Error(result.error || 'Data tidak valid');
                }
            } catch (error) {
                addLogEntry('Gagal memuat data: ' + error.message, 'error');
                alert('Gagal memuat data. Pastikan Web App sudah di-deploy dengan benar.\n\nError: ' + error.message);
            }
        }

        async function syncPairwiseToSheet() {
            if (!gsheetSettings.webAppUrl) {
                alert('Silakan setup Google Sheets terlebih dahulu di tab Settings');
                return;
            }
            
            if (Object.keys(scores).length === 0) {
                alert('Belum ada hasil Pairwise Comparison untuk disimpan');
                return;
            }
            
            calculateScores();
            
            const sortedOptions = pairwiseOptions
                .map((opt, i) => ({ text: opt, index: i, score: scores[i] }))
                .sort((a, b) => b.score - a.score);
            
            const data = {
                type: 'pairwise',
                totalComparisons: comparisons.length,
                results: sortedOptions.map((opt, rank) => ({
                    text: opt.text,
                    rank: rank + 1,
                    score: opt.score
                }))
            };
            
            try {
                addLogEntry('Mengirim hasil Pairwise...', '');
                
                await fetch(gsheetSettings.webAppUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                addLogEntry('Hasil Pairwise berhasil disync ke Google Sheets', 'success');
                alert('Hasil prioritas berhasil disimpan ke Google Sheets!');
            } catch (error) {
                addLogEntry('Gagal sync Pairwise: ' + error.message, 'error');
                alert('Gagal menyimpan: ' + error.message);
            }
        }

        function addLogEntry(message, type) {
            const container = document.getElementById('log-entries');
            const emptyMsg = container.querySelector('.log-empty');
            if (emptyMsg) emptyMsg.remove();
            
            const time = new Date().toLocaleTimeString('id-ID');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <span class="log-time">${time}</span>
                <span class="log-message ${type}">${message}</span>
            `;
            
            container.insertBefore(entry, container.firstChild);
            
            // Keep only last 10 entries
            while (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }

        function toggleAppsScript() {
            const el = document.getElementById('apps-script-code');
            el.style.display = el.style.display === 'none' ? 'block' : 'none';
        }

        function copyAppsScript() {
            const code = document.querySelector('.script-code').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('Kode berhasil dicopy! Paste ke Google Apps Script editor.');
            }).catch(err => {
                alert('Gagal copy. Silakan select dan copy manual.');
            });
        }

        // ==================== PWA INSTALLATION ====================
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install banner if not dismissed recently
            const dismissed = localStorage.getItem('pwaBannerDismissed');
            const dismissedTime = dismissed ? parseInt(dismissed) : 0;
            const daysSinceDismissed = (Date.now() - dismissedTime) / (1000 * 60 * 60 * 24);
            
            if (daysSinceDismissed > 7) {
                document.getElementById('pwa-install-banner').classList.add('show');
            }
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA installed');
                    }
                    deferredPrompt = null;
                    document.getElementById('pwa-install-banner').classList.remove('show');
                });
            }
        }

        function dismissPWABanner() {
            document.getElementById('pwa-install-banner').classList.remove('show');
            localStorage.setItem('pwaBannerDismissed', Date.now().toString());
        }

        // Register Service Worker for offline capability
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Create inline service worker
                const swCode = `
                    const CACHE_NAME = 'sync-planner-v1';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                // Note: Inline SW won't work in production, but the app will still function
                // For full offline support, deploy with a separate sw.js file
            });
        }

        // Initialize
        loadFromLocalStorage();
        loadPairwiseFromLocalStorage();
        loadGSheetSettings();
    </script>
</body>
</html>
